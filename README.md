# Документация по запуску проекта с использованием Docker Compose

## Описание

Этот проект использует `docker-compose` для управления несколькими сервисами: приложением, веб-сервером (Nginx), сервером RPC, брокером сообщений RabbitMQ, и базой данных PostgreSQL. Эти сервисы связаны между собой с помощью Docker-сети для упрощения локального развертывания и работы.

## Шаги для запуска

1. **Клонируйте репозиторий**:

    ```bash
    git clone <URL_репозитория>
    cd <папка_с_проектом>
    ```

2. **Создайте файл `.env`**:
    В каталоге `app` создайте файл `.env` и добавьте туда переменные окружения, необходимые для конфигурации базы данных PostgreSQL и RabbitMQ.

    Пример содержимого `.env` файла:

    ```env
    # Конфигурация базы данных PostgreSQL
    POSTGRES_USER=myuser
    POSTGRES_PASSWORD=mypassword
    POSTGRES_DB=mydatabase

    # Секретный ключ приложения
    SECRET_KEY=your_secret_key

    # Настройки для RabbitMQ
    RABBITMQ_HOST=rabbitmq
    RABBITMQ_QUEUE=rpc_queue
    RABBITMQ_DEFAULT_USER=guest
    RABBITMQ_DEFAULT_PASS=guest
    ```

3. **Запустите проект**:
    После настройки файла `.env`, вы можете запустить проект с помощью `docker-compose`:

    ```bash
    docker-compose up
    ```

    Это создаст и запустит все контейнеры, указанные в `docker-compose.yml`, в том числе:
    - Приложение
    - Веб-сервер (Nginx)
    - Сервер RPC
    - RabbitMQ
    - База данных PostgreSQL

4. **Остановите проект**:
    Чтобы остановить все контейнеры, выполните команду:

    ```bash
    docker-compose down
    ```

    Это остановит и удалит все контейнеры, созданные в процессе работы.

## Описание переменных окружения

Переменные окружения конфигурируются в файле `.env` и используются для настройки соединений с базой данных PostgreSQL и RabbitMQ.

| Переменная              | Описание                                                                                |
|-------------------------|-----------------------------------------------------------------------------------------|
| **`POSTGRES_USER`**     | Имя пользователя базы данных PostgreSQL.                                                |
| **`POSTGRES_PASSWORD`** | Пароль для пользователя базы данных PostgreSQL.                                         |
| **`POSTGRES_DB`**       | Имя базы данных, которая будет создана при запуске контейнера PostgreSQL.               |
| **`SECRET_KEY`**        | Секретный ключ для криптографии и безопасности приложения.                              |
| **`RABBITMQ_HOST`**     | Адрес хоста для подключения к RabbitMQ (обычно “rabbitmq”, если используется имя контейнера в сети Docker). |
| **`RABBITMQ_QUEUE`**    | Имя очереди в RabbitMQ для передачи сообщений.                                          |
| **`RABBITMQ_DEFAULT_USER`** | Логин для доступа к RabbitMQ.                                                        |
| **`RABBITMQ_DEFAULT_PASS`** | Пароль для доступа к RabbitMQ.                                                       |

### Примечания

- Контейнер PostgreSQL монтирует данные на локальном хосте в директорию `./postgres_data` для сохранения данных.
- Убедитесь, что все указанные переменные окружения правильно настроены в файле `.env` перед запуском `docker-compose`.

### Запуск тестов

Для запуска тестов выполните:

```sh
export PYTHONPATH="${PYTHONPATH}:./src"
pytest tests
```

---

**Примечание:** При холодном старте сервиса база данных PostgreSQL не всегда успевает проинициализироваться, из-за чего иногда сервис `app` стартует с ошибками. В таком случае рекомендуется остановить сервис `docker-compose down` и перезапустить его `docker-compose up`.
